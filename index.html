<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LOTO breton</title>
<style>
    body {
        background-color: #fef9f7;
        font-family: Arial, sans-serif;
        color: #333;
        padding: 20px;
        max-width: 900px;
        margin: auto;
        line-height: 1.6;
    }

    h1 {
        color: #bb6bd9;
        text-align: center;
        margin-bottom: 30px;
    }

    .section {
        background-color: #fff7e6;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        text-align: center;
    }

    button {
        padding: 12px 20px;
        margin: 8px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        color: #fff;
        transition: transform 0.1s, background-color 0.2s;
    }

    button:hover {
        transform: translateY(-2px);
    }

    .btn-regle { background-color: #bb6bd9; }
    .btn-regle:hover { background-color: #a152c2; }

    .btn-vocab { background-color: #ff8c42; }
    .btn-vocab:hover { background-color: #e57b30; }

    .btn-son { background-color: #4CAF50; }
    .btn-son:hover { background-color: #3b8f3b; }

    .config, .controls {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
    }

    input[type="number"] {
        padding: 6px;
        border-radius: 6px;
        border: 1px solid #ccc;
        width: 60px;
        text-align: center;
    }

    .grid {
        display: grid;
        gap: 8px;
        margin: 0 auto 20px;
    }

    .cell {
        min-height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 8px;
        border-radius: 8px;
        border: 1px solid #ccc;
        background-color: #fff0e6;
        cursor: pointer;
        user-select: none;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        text-align: center;
    }

    .marked {
        background-color: #4CAF50;
        color: white;
        text-decoration: line-through;
        border-color: #3b8f3b;
    }

    .center {
        background-color: #b2e2b2;
        font-weight: bold;
        border-color: #4CAF50;
        cursor: default;
    }

    .status {
        text-align: center;
        margin-bottom: 15px;
        font-weight: bold;
        color: #555;
    }
</style>
</head>
<body>

<h1>LOTO breton</h1>

<div class="section">
    <button class="btn-regle" onclick="window.location.href='regle_du_jeu.html'">Règle du jeu</button>
    <button class="btn-vocab" onclick="window.location.href='fiche_vocabulaire.html'">Fiche vocabulaire</button>
    <button class="btn-son" id="playButton">Jouer un son aléatoire</button>
    <audio id="audioPlayer" controls></audio>
</div>

<div class="section config">
    <label>Taille : <input id="gridSize" type="number" min="3" max="10" value="5"></label>
    <label>Case centrale libre : <input id="freeCenter" type="checkbox" checked></label>
</div>

<div class="section controls">
    <button id="generateBtn">Générer</button>
    <button id="clearMarksBtn">Effacer</button>
    <button id="saveBtn">Sauvegarder</button>
    <button id="loadBtn">Charger</button>
</div>

<div class="status" id="status">Prêt.</div>
<div id="gridContainer" class="grid"></div>
<div class="small">Clique sur une case pour cocher/décocher (sauf LOTO).</div>

<script>
const vocabulary = [
  "Un far breton","Brocéliande","Une galette au sarrasin","Un kouign amann","Un menhir",
  "Un chapeau bigouden","Le Fest-noz","Un cidre","Une crêpe au froment","Un fruit de mer",
  "Un conte de Korrigen","Un biniou","La langue bretonne","Breizh","Jeanne d'Arc",
  "La trinité","Une hermine","Un triskell","Un arbre de vie","Une croix celtique",
  "Gwenn ha Du","La fontaine de jouvence","Un druide","Une rune","Merlin",
  "Carnac","Une légende","Une cité médiévale","Saint-Malo","Saint-Brieuc"
];

const GRID_KEY = "loto_grid";
const MARKS_KEY = "loto_marks";

const gridContainer = document.getElementById("gridContainer");
const status = document.getElementById("status");

function shuffle(arr) {
  arr = arr.slice();
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function generateGrid(size = 5, freeCenter = true) {
  const total = size * size;
  const pool = shuffle(vocabulary.slice());
  const cells = pool.slice(0, total);

  if (freeCenter && size % 2 === 1) {
    const center = Math.floor(total / 2);
    cells[center] = "LOTO";
  }

  localStorage.setItem(GRID_KEY, JSON.stringify({ size, cells }));
  renderGrid(size, cells);
  status.textContent = "Nouvelle grille générée.";
}

function renderGrid(size, cells) {
  gridContainer.innerHTML = "";
  gridContainer.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
  const marks = loadMarks();

  cells.forEach((text, index) => {
    const cell = document.createElement("div");
    cell.className = "cell";

    if (text === "LOTO" && index === Math.floor(cells.length/2)) {
      cell.classList.add("center");
    } else {
      if (marks && marks[index]) cell.classList.add("marked");
      cell.addEventListener("click", () => toggleMark(index, cell));
    }

    cell.textContent = text;
    gridContainer.appendChild(cell);
  });
}

function toggleMark(i, cell) {
  cell.classList.toggle("marked");
  saveMarks();
}

function saveMarks() {
  const marks = [...gridContainer.children].map(c => c.classList.contains("marked"));
  localStorage.setItem(MARKS_KEY, JSON.stringify(marks));
}

function loadMarks() {
  const raw = localStorage.getItem(MARKS_KEY);
  return raw ? JSON.parse(raw) : null;
}

function clearMarks() {
  [...gridContainer.children].forEach(c => {
    if (!c.classList.contains("center")) c.classList.remove("marked");
  });
  localStorage.removeItem(MARKS_KEY);
  status.textContent = "Marques effacées.";
}

function loadGrid() {
  const raw = localStorage.getItem(GRID_KEY);
  if (!raw) { status.textContent = "Aucune grille enregistrée."; return; }
  const data = JSON.parse(raw);
  renderGrid(data.size, data.cells);
  status.textContent = "Grille chargée.";
}

document.getElementById("generateBtn").onclick = () => {
  generateGrid(parseInt(document.getElementById("gridSize").value), document.getElementById("freeCenter").checked);
};
document.getElementById("clearMarksBtn").onclick = clearMarks;
document.getElementById("saveBtn").onclick = saveMarks;
document.getElementById("loadBtn").onclick = loadGrid;

window.onload = loadGrid;
</script>

</body>
</html>
